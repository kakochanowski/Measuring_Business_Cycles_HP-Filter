---
title: "PS 1 Sample Code"
output:
  html_document:
    df_print: paged
---

```{r}
library(readxl) #reading excel files
library(tidyverse)
library(haven)
library(dplyr)
install.packages("mFilter")
library(mFilter) #Package used for hp filter
library(cowplot) #Allows for side by side graphs
```

## Read data from Excel file and select relevant fields
```{r}
#Kiersten's WD
getwd()
#install.packages("readxl")
library(readxl)
original <- read_excel("/Users/Kiersten/Documents/School/Session 3/Macro/Measuring_Business_Cycles_HP-Filter/Data/usg_data_annual.xls")
#View(original)
#Select United States and South Korea data
US<- filter(original, Country_Name=="United States" | Country_Name=="Korea, Rep.")
#View(GDP1)

#Filter for relevant business-cycle statistics
GDP2 <- filter(GDP1, Indicator_Code=="NY.GDP.PCAP.KN" | Indicator_Code=="NE.CON.PETC.ZS" | Indicator_Code=="NE.GDI.TOTL.ZS" | Indicator_Code=="NE.CON.GOVT.ZS" | Indicator_Code=="NE.IMP.GNFS.ZS" | Indicator_Code=="NE.EXP.GNFS.ZS")
#View(GDP2)
```

## Restructuring data so year is its own variable
South Korea data

```{r}
#Separating DFs by country to make restructuring simpler (maybe)
SKorea<- filter(GDP2, Country_Name=="Korea, Rep.")
#View(SKorea)

#Remove first three columns in order to transpose
SKorea2 <- t(SKorea)
#View(SKorea2)
SKorea3 <- SKorea2[-c(1,2,3),]
#View(SKorea3)

#Change values to numeric
SKorea3 <- as.data.frame(SKorea3)

#Rename variables
SKorea4 <- SKorea3 %>%
  select(V1, V2, V3, V4, V5, V6) %>%
  rename(NY.GDP.PCAP.KN = V1, NE.GDI.TOTL.ZS = V2, NE.CON.GOVT.ZS = V3, NE.IMP.GNFS.ZS = V4, NE.EXP.GNFS.ZS = V5, NE.CON.PETC.ZS = V6)

#View(SKorea4)
SKorea5 <- SKorea4[-c(1),]
#View(SKorea5)

#Add Country variable
Country <- as.list(rep("S. Korea", 52))
length(Country)
country <- as.data.frame(Country)
#View(country)
country2 <- t(country)
#View(country2)
SKorea6 <- cbind(SKorea5, country2)
#View(SKorea6)
#Create year variable 
SKorea_final <- tibble::rownames_to_column(SKorea6, "YEAR")
SKorea_final <- rename(SKorea_final, COUNTRY = country2)
SKorea_final <- select(SKorea_final, "YEAR", "COUNTRY", "NY.GDP.PCAP.KN", "NE.GDI.TOTL.ZS", "NE.CON.GOVT.ZS", "NE.IMP.GNFS.ZS", "NE.EXP.GNFS.ZS", "NE.CON.PETC.ZS")
View(SKorea_final)
```

US data
```{r}
US<- filter(GDP2, Country_Name=="United States")
#View(US)

#Remove first three columns in order to transpose
US2 <- t(US)
#View(US2)
US3 <- US2[-c(1,2,3),]
#View(US3)

#Change values to numeric
US3 <- as.data.frame(US3)

#Rename variables
US4 <- US3 %>%
  select(V1, V2, V3, V4, V5, V6) %>%
  rename(NY.GDP.PCAP.KN = V1, NE.GDI.TOTL.ZS = V2, NE.CON.GOVT.ZS = V3, NE.IMP.GNFS.ZS = V4, NE.EXP.GNFS.ZS = V5, NE.CON.PETC.ZS = V6)

#View(US4)
US5 <- US4[-c(1),]
#View(US5)

#Add Country variable
Countryb <- as.list(rep("US", 52))
length(Countryb)
countryb <- as.data.frame(Countryb)
#View(countryb)
countryb2 <- t(countryb)
#View(countryb2)
US6 <- cbind(US5, countryb2)
View(US6)
#Create year variable 
US_final <- tibble::rownames_to_column(US6, "YEAR")
US_final <- rename(US_final, COUNTRY = countryb2)
US_final <- select(US_final, "YEAR", "COUNTRY", "NY.GDP.PCAP.KN", "NE.GDI.TOTL.ZS", "NE.CON.GOVT.ZS", "NE.IMP.GNFS.ZS", "NE.EXP.GNFS.ZS", "NE.CON.PETC.ZS")
View(US_final)

```

## Merge data sets
```{r}
GDP_data <- rbind(SKorea_final, US_final)
GDP_data <- rename(GDP_data, GDPCapita = NY.GDP.PCAP.KN, HHConPct = NE.CON.PETC.ZS, GCapFormPct = NE.GDI.TOTL.ZS, GovtConPct = NE.CON.GOVT.ZS, ImpPct = NE.IMP.GNFS.ZS, ExpPct = NE.EXP.GNFS.ZS)
GDP_data$GDPCapita <- as.numeric(GDP_data$GDPCapita)
GDP_data$HHConPct <- as.numeric(GDP_data$HHConPct)
GDP_data$GCapFormPct <- as.numeric(GDP_data$GCapFormPct)
GDP_data$GovtConPct <- as.numeric(GDP_data$GovtConPct)
GDP_data$ImpPct <- as.numeric(GDP_data$ImpPct)
GDP_data$ExpPct <- as.numeric(GDP_data$ExpPct)
View(GDP_data)
```

## Read data from Excel file and create a logged measure of real GDP
```{r}
#Find log Real GDP
GDP_data$logGDP<-log(GDP_data$GDPCapita)
```


## Compute the relevant business-cycle statistics for the following alternative detrending methods
i. HP filtering with lambda= 100
ii. HP filtering with lambda= 6.25

## Use Hodrick-Prescott filter to estimate cylce and secular components of time series.
```{r}
#Logged GDP/capita with lambda
gdp.hp<-hpfilter(GDP_data$logGDP, freq = 100,type = "lambda")
GDP_data$gdp_T<-gdp.hp$trend
GDP_data$gdp_C<-gdp.hp$cycle
head(GDP_data)

#Logged GDP/capita
gdp.hp<-hpfilter(GDP_data$logGDP, freq = 100,type = "lambda")
GDP_data$gdp_T<-gdp.hp$trend
GDP_data$gdp_C<-gdp.hp$cycle
head(GDP_data)

```


## Draw two figures. 
* On the first, draw the raw data and the secular trend estimate. 
* On the second draw the GDP cycle estimate.


```{r}
plot1<-ggplot(data=gdp_data)+ 
geom_line(aes(x=ryear,y=lgdp,color='Log GDP'),size=1.5) + geom_line(aes(x=ryear,y=gdp_T,color='Log GDP Secular'),linetype=2,size=1.5) +xlab("Year")+ylab("")+scale_colour_manual(name="",values=c('Log GDP'='blue','Log GDP Secular'='red'))+ggtitle('GDP Trend')+theme(plot.title = element_text(hjust = 0.5))
```
```{r}
plot2<-ggplot(data=gdp_data)+ 
geom_line(aes(x=ryear,y=gdp_C,color='Log GDP Cycle'),size=1.5,linetype=2)  +xlab("Year")+ylab("")+scale_colour_manual(name="",values=c('Log GDP Cycle'='blue'))+ggtitle('GDP Cycle')+theme(plot.title = element_text(hjust = 0.5))
```



```{r}
plot_grid(plot1, plot2,ncol = 1,align = 'v')
```

## Make a 2x2 graph showing the natural logarithm of real per capita GDP and the trend, one panel per trend
- Discuss how the detrending method influences the volatility of the cyclical component of outpt
- Discuss which detrending method identifies recessions for the United States most in line with the NBER business-cycle dates
